---
import Layout from '../layouts/Layout.astro';
import Button from '../components/Button.astro';
import CodeBlock from '../components/CodeBlock.astro';
import Terminal from '../components/Terminal.astro';
import { css } from '../../styled-system/css';
import { links } from '../config/links';
---

<Layout
  title="pgmt - PostgreSQL Schema Development, Reimagined"
  description="Edit database objects like code. See changes instantly. Deploy with confidence. The PostgreSQL migration tool built for modern development."
>
  <!-- Hero: Demo-first -->
  <section
    class={css({
      paddingTop: { base: '2xl', md: '3xl' },
      paddingBottom: { base: 'xl', md: '2xl' },
      background:
        'linear-gradient(180deg, rgba(79, 195, 247, 0.08) 0%, transparent 100%)',
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
      })}
    >
      <!-- Headline -->
      <div class={css({ textAlign: 'center', marginBottom: 'xl' })}>
        <h1
          class={css({
            fontSize: { base: '2xl', md: '4xl' },
            fontWeight: '700',
            fontFamily: 'heading',
            color: 'text.primary',
            marginBottom: 'sm',
            lineHeight: '1.2',
          })}
        >
          Edit your schema.{' '}
          pgmt handles{' '}
          <span
            class={css({
              background:
                'linear-gradient(135deg, #00D4FF 0%, #FF6B9D 50%, #00D4FF 100%)',
              backgroundClip: 'text',
              color: 'transparent',
              backgroundSize: '200% 200%',
              animation: 'gradient-shift',
            })}
          >
            the rest.
          </span>
        </h1>
        <p
          class={css({
            fontSize: { base: 'md', md: 'lg' },
            color: 'text.secondary',
            maxWidth: '3xl',
            marginX: 'auto',
          })}
        >
          A schema-as-code tool for PostgreSQL with dependency tracking, instant
          apply, and production-ready migrations.
        </p>
      </div>

      <!-- Demo terminal -->
      <div class={css({ marginBottom: 'lg' })}>
        <Terminal title="terminal">
          <pre><span class="prompt">$</span> git diff schema/functions/calculate_score.sql
  CREATE OR REPLACE FUNCTION calculate_score(
<span class="removed">-   user_id INTEGER</span>
<span class="added">+   user_id INTEGER,</span>
<span class="added">+   include_bonus BOOLEAN DEFAULT false</span>
  )

<span class="prompt">$</span> pgmt apply

ğŸ“‹ 8 changes

  âœ“ Drop view public.executive_dashboard
  âœ“ Drop view public.daily_stats
  âœ“ Drop view public.user_rankings
  âœ“ Update function public.calculate_score(integer)
  âœ“ Create function public.calculate_score(integer, boolean)
  âœ“ Create view public.user_rankings
  âœ“ Create view public.daily_stats
  âœ“ Create view public.executive_dashboard

âœ… Applied 8 changes</pre>
        </Terminal>
      </div>

      <!-- Context row: dependency tree + caption -->
      <div
        class={css({
          display: 'flex',
          flexDirection: { base: 'column', md: 'row' },
          alignItems: { base: 'stretch', md: 'flex-start' },
          gap: 'lg',
          marginBottom: 'xl',
        })}
      >
        <div
          class={css({
            flex: '1',
            padding: 'lg',
            borderRadius: 'lg',
            backgroundColor: 'surface',
            border: '1px solid',
            borderColor: 'border',
          })}
        >
          <p
            class={css({
              fontSize: 'xs',
              fontWeight: '600',
              color: 'text.muted',
              textTransform: 'uppercase',
              letterSpacing: '0.05em',
              marginBottom: 'sm',
            })}
          >
            Your schema files
          </p>
          <pre
            class={css({
              margin: '0',
              fontFamily: 'mono',
              fontSize: 'sm',
              lineHeight: '1.6',
              color: 'text.secondary',
            })}>{`schema/
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ calculate_score.sql`}  <span class={css({ color: 'accent', fontWeight: '600' })}>â† changed</span>{`
â””â”€â”€ views/
    â”œâ”€â”€ user_rankings.sql`}       <span class={css({ color: '#FF6B9D' })}>â† depends</span>{`
    â”œâ”€â”€ daily_stats.sql`}         <span class={css({ color: '#FF6B9D' })}>â† depends</span>{`
    â””â”€â”€ executive_dashboard.sql`} <span class={css({ color: '#FF6B9D' })}>â† depends</span></pre>
        </div>

        <div
          class={css({
            flex: '1',
            padding: 'lg',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'center',
          })}
        >
          <p
            class={css({
              fontSize: 'md',
              color: 'text.secondary',
              lineHeight: '1.7',
            })}
          >
            <strong class={css({ color: 'text.primary' })}
              >One function changed.</strong
            >{' '}
            pgmt detected 3 dependent views, dropped them in the right order, applied
            the update, and recreated everything â€” automatically.
          </p>
          <p
            class={css({
              fontSize: 'sm',
              color: 'text.muted',
              marginTop: 'sm',
            })}
          >
            No manual dependency tracking. No copy-paste errors. No broken
            deploys.
          </p>
        </div>
      </div>

      <!-- CTAs -->
      <div
        class={css({
          display: 'flex',
          justifyContent: 'center',
          gap: 'lg',
          flexWrap: 'wrap',
        })}
      >
        <Button href={links.docs.quickStart} size="lg">Get Started</Button>
        <Button
          href="/blog/schema-migrations-arent-the-problem"
          variant="outline"
          size="lg"
        >
          Read the blog post â†’
        </Button>
      </div>
    </div>
  </section>

  <!-- Watch Mode -->
  <section
    class={css({
      paddingY: { base: '2xl', md: '3xl' },
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
      })}
    >
      <div
        class={css({
          display: 'flex',
          flexDirection: { base: 'column', md: 'row' },
          alignItems: { base: 'stretch', md: 'center' },
          gap: 'xl',
        })}
      >
        <div class={css({ flex: '1' })}>
          <h2
            class={css({
              fontSize: { base: 'xl', md: '2xl' },
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'sm',
            })}
          >
            Your database, with hot reload
          </h2>
          <p
            class={css({
              fontSize: 'md',
              color: 'text.secondary',
              lineHeight: '1.7',
            })}
          >
            Run <code
              class={css({
                fontFamily: 'mono',
                fontSize: 'sm',
                backgroundColor: 'surface',
                padding: '2px 6px',
                borderRadius: 'sm',
                border: '1px solid',
                borderColor: 'border',
              })}>pgmt apply --watch</code
            > and forget about it. Edit a schema file, save â€” your dev database updates
            instantly. No migration files during development, no manual dependency
            management.
          </p>
        </div>
        <div class={css({ flex: '1' })}>
          <Terminal title="terminal">
            <pre><span class="prompt">$</span> pgmt apply --watch
<span class="dim">ğŸ‘€ Watching schema/ for changes...</span>

<span class="added">  schema/functions/calculate_score.sql changed</span>

ğŸ“‹ 8 changes
  âœ“ Drop view public.executive_dashboard
  <span class="dim">  ...</span>
  âœ“ Create view public.executive_dashboard

âœ… Applied 8 changes</pre>
          </Terminal>
        </div>
      </div>
    </div>
  </section>

  <!-- Production Migrations -->
  <section
    class={css({
      paddingY: { base: '2xl', md: '3xl' },
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
      })}
    >
      <div
        class={css({
          display: 'flex',
          flexDirection: { base: 'column', md: 'row' },
          alignItems: { base: 'stretch', md: 'center' },
          gap: 'xl',
        })}
      >
        <div class={css({ flex: '1' })}>
          <h2
            class={css({
              fontSize: { base: 'xl', md: '2xl' },
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'sm',
            })}
          >
            Production-ready when you are
          </h2>
          <p
            class={css({
              fontSize: 'md',
              color: 'text.secondary',
              lineHeight: '1.7',
              marginBottom: 'md',
            })}
          >
            When you're done iterating, generate an explicit migration file.
            Review it, edit it, deploy it. Nothing touches production without
            you approving it.
          </p>
          <p
            class={css({
              fontSize: 'sm',
              color: 'text.muted',
              lineHeight: '1.7',
            })}
          >
            Multi-section migrations handle the hard stuff: concurrent indexes,
            data backfills, different timeouts and transaction modes â€” all in
            one file, with per-section retries.
          </p>
        </div>
        <div class={css({ flex: '1' })}>
          <CodeBlock
            code={`-- pgmt:section name="add_column"
--   timeout="5s"
ALTER TABLE users
  ADD COLUMN verified BOOLEAN;

-- pgmt:section name="backfill"
--   mode="autocommit" timeout="30m"
UPDATE users SET verified = false
  WHERE verified IS NULL;

-- pgmt:section name="add_index"
--   mode="non-transactional"
--   retry_attempts="10"
CREATE INDEX CONCURRENTLY
  idx_users_verified ON users(verified);`}
            language="sql"
            title="V001__add_verified_column.sql"
            showCopy={false}
          />
        </div>
      </div>
    </div>
  </section>

  <!-- PR Review -->
  <section
    class={css({
      paddingY: { base: '2xl', md: '3xl' },
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
      })}
    >
      <h2
        class={css({
          fontSize: { base: 'xl', md: '2xl' },
          fontWeight: '600',
          color: 'text.primary',
          marginBottom: 'sm',
          textAlign: 'center',
        })}
      >
        Your team reviews intent, not mechanics
      </h2>
      <p
        class={css({
          fontSize: 'md',
          color: 'text.secondary',
          lineHeight: '1.7',
          textAlign: 'center',
          maxWidth: '3xl',
          marginX: 'auto',
          marginBottom: 'xl',
        })}
      >
        With traditional migrations, PRs show a wall of DROP and CREATE
        statements. With pgmt, your schema files are code â€” the diff shows what
        actually changed.
      </p>

      <div
        class={css({
          display: 'grid',
          gridTemplateColumns: { base: '1fr', md: '1fr 1fr' },
          gap: 'lg',
          maxWidth: '4xl',
          marginX: 'auto',
        })}
      >
        <CodeBlock
          code={`-- migrations/V042__update_score.sql
DROP VIEW executive_dashboard;
DROP VIEW daily_stats;
DROP VIEW user_rankings;
DROP FUNCTION calculate_score(integer);
CREATE FUNCTION calculate_score(
  user_id INTEGER,
  include_bonus BOOLEAN DEFAULT false
) RETURNS INTEGER AS $$ ... $$;
CREATE VIEW user_rankings AS ...
CREATE VIEW daily_stats AS ...
CREATE VIEW executive_dashboard AS ...`}
          language="sql"
          title="Traditional migration PR"
          showCopy={false}
        />
        <CodeBlock
          code={` -- schema/functions/calculate_score.sql

 CREATE OR REPLACE FUNCTION calculate_score(
   user_id INTEGER,
+  include_bonus BOOLEAN DEFAULT false
 ) RETURNS INTEGER AS $$
   ...
 $$ LANGUAGE plpgsql;`}
          language="diff"
          title="pgmt schema PR"
          showCopy={false}
        />
      </div>
    </div>
  </section>

  <!-- And more -->
  <section
    class={css({
      paddingY: { base: 'xl', md: '2xl' },
      backgroundColor: 'surface',
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
      })}
    >
      <div
        class={css({
          display: 'grid',
          gridTemplateColumns: { base: '1fr 1fr', md: 'repeat(4, 1fr)' },
          gap: 'lg',
        })}
      >
        <div class={css({ textAlign: 'center' })}>
          <p
            class={css({
              fontSize: 'sm',
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'xs',
            })}
          >
            Drift Detection
          </p>
          <p class={css({ fontSize: 'xs', color: 'text.muted' })}>
            Detect unauthorized production changes with CI-ready JSON output
          </p>
        </div>
        <div class={css({ textAlign: 'center' })}>
          <p
            class={css({
              fontSize: 'sm',
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'xs',
            })}
          >
            Easy Rebase
          </p>
          <p class={css({ fontSize: 'xs', color: 'text.muted' })}>
            Branch behind? Regenerate your migration with one command
          </p>
        </div>
        <div class={css({ textAlign: 'center' })}>
          <p
            class={css({
              fontSize: 'sm',
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'xs',
            })}
          >
            Full PostgreSQL
          </p>
          <p class={css({ fontSize: 'xs', color: 'text.muted' })}>
            Triggers, RLS, grants, custom types, extensions â€” not just tables
          </p>
        </div>
        <div class={css({ textAlign: 'center' })}>
          <p
            class={css({
              fontSize: 'sm',
              fontWeight: '600',
              color: 'text.primary',
              marginBottom: 'xs',
            })}
          >
            Any Framework
          </p>
          <p class={css({ fontSize: 'xs', color: 'text.muted' })}>
            Works alongside Rails, Django, Go, Node â€” pgmt manages the schema,
            your app reads it
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section
    class={css({
      paddingY: { base: '3xl', md: '4xl' },
    })}
  >
    <div
      class={css({
        maxWidth: '4xl',
        marginX: 'auto',
        paddingX: { base: 'lg', md: 'xl' },
        textAlign: 'center',
      })}
    >
      <h2
        class={css({
          fontSize: { base: '2xl', md: '3xl' },
          fontWeight: '700',
          fontFamily: 'heading',
          color: 'text.primary',
          marginBottom: 'md',
        })}
      >
        Ready to try it?
      </h2>
      <p
        class={css({
          fontSize: { base: 'md', md: 'lg' },
          color: 'text.secondary',
          marginBottom: '2xl',
        })}
      >
        Get started in minutes.
      </p>

      <div
        class={css({
          maxWidth: '24rem',
          marginX: 'auto',
          marginBottom: 'xl',
        })}
      >
        <CodeBlock
          code="cargo install pgmt"
          language="bash"
          title="Install pgmt"
        />
      </div>

      <div
        class={css({
          display: 'flex',
          justifyContent: 'center',
          gap: 'lg',
          flexWrap: 'wrap',
        })}
      >
        <Button href={links.docs.quickStart} size="lg">Get Started</Button>
        <Button href={links.docs.root} variant="outline" size="lg">
          Read the Docs
        </Button>
      </div>
    </div>
  </section>
</Layout>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
