---
import { cva } from '../../styled-system/css';

export interface Props {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  href?: string;
  target?: string;
  rel?: string;
  class?: string;
}

const {
  variant = 'primary',
  size = 'md',
  href,
  target,
  rel,
  class: className = '',
  ...props
} = Astro.props;

const buttonVariants = cva({
  base: {
    display: 'inline-flex',
    alignItems: 'center',
    justifyContent: 'center',
    gap: 'sm',
    fontWeight: '600',
    textDecoration: 'none',
    borderRadius: 'md',
    transition: 'all 0.2s ease',
    cursor: 'pointer',
    border: 'none',
    fontFamily: 'inherit',
    userSelect: 'none',
    _focusVisible: {
      outline: '2px solid',
      outlineColor: 'pgblue.400',
      outlineOffset: '2px',
    },
    _disabled: {
      opacity: '0.5',
      cursor: 'not-allowed',
    },
  },
  variants: {
    variant: {
      primary: {
        background: 'token(gradients.button-glow)',
        color: 'white',
        position: 'relative',
        overflow: 'hidden',
        boxShadow: '0 0 20px rgba(0, 212, 255, 0.3)',
        _before: {
          content: '""',
          position: 'absolute',
          top: '0',
          left: '-100%',
          width: '100%',
          height: '100%',
          background: 'token(gradients.shimmer)',
          animation: 'token(animations.shimmer-sweep)',
          animationDelay: '1s',
        },
        _hover: {
          transform: 'translateY(-2px)',
          boxShadow:
            '0 0 30px rgba(0, 212, 255, 0.5), 0 0 60px rgba(255, 107, 157, 0.2)',
          animation: 'token(animations.rainbow-glow)',
        },
        _active: {
          transform: 'translateY(-1px)',
        },
      },
      secondary: {
        backgroundColor: 'surface-raised',
        color: 'text-primary',
        _hover: {
          backgroundColor: 'pgblue.800',
          transform: 'translateY(-1px)',
        },
        _active: {
          transform: 'translateY(0)',
        },
      },
      outline: {
        backgroundColor: 'transparent',
        color: 'text-primary',
        border: '1px solid',
        borderColor: 'border',
        _hover: {
          backgroundColor: 'surface',
          borderColor: 'text-muted',
          transform: 'translateY(-1px)',
        },
        _active: {
          transform: 'translateY(0)',
        },
      },
      ghost: {
        backgroundColor: 'transparent',
        color: 'text-secondary',
        _hover: {
          backgroundColor: 'surface',
          color: 'text-primary',
        },
      },
    },
    size: {
      sm: {
        fontSize: 'sm',
        padding: { base: '0.5rem 1rem', md: '0.375rem 0.75rem' },
        height: { base: '44px', md: '2rem' }, // Better touch targets on mobile
        minWidth: { base: '44px' },
      },
      md: {
        fontSize: 'md',
        padding: { base: '0.75rem 1.5rem', md: '0.5rem 1.25rem' },
        height: { base: '48px', md: '2.5rem' },
        minWidth: { base: '48px' },
      },
      lg: {
        fontSize: 'lg',
        padding: { base: '1rem 2rem', md: '0.75rem 1.5rem' },
        height: { base: '52px', md: '3rem' },
        minWidth: { base: '52px' },
      },
    },
  },
});

const Component = href ? 'a' : 'button';
const linkProps = href ? { href, target, rel } : {};
---

<Component
  class={`${buttonVariants({ variant, size })} ${className}`}
  {...linkProps}
  {...props}
>
  <slot />
</Component>
